<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>

    <link rel="stylesheet" href="./resources/bootstrap.min.css">
    <script src="./resources/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="./login-style.css">
    <link rel="stylesheet" href="./common.css">
    <script src="./resources/jquery.min.js"></script>
    <script src="./lib.js"></script>
    <script src="./api.js"></script>
</head>
<body>
    <script>
        api.getUserInfo({
            onDone: (resultUser) => {
                window.location.href = './index.html'
            },
            onFailed: () => 1
        })
    </script>
    <div id="top">
        <div class="left">
            <span>Accessibility</span>
        </div>

        <div class="right">
            <div class="group-name">Nhập môn Công nghệ phần mềm</div>
        </div>
    </div>

    <div class="wrap">
        <div id="content">
            <form action="" class="login">
                <div class="header">Welcome!</div>
                <div class="sub-header">Sign in to continue</div>

                <input type="text" placeholder="@username = 'hung' to login" class="primary username">
                <input type="text" placeholder="Password = '123' to login" class="primary password">

                <div class="errors"></div>

                <div class="button-group">
                    <button class="login primary">Login</button>
                    <button class="sign-up primary">Sign up</button>
                </div>
            </form>

            <form action="" class="sign-up" style="display: none;">
                <div class="header">Sign up</div>
                <div class="sub-header">to start your journey</div>

                <input type="text" placeholder="Your name" class="primary fullname">
                <input type="text" placeholder="@username" class="primary username">
                <input type="text" placeholder="Password" class="primary password">
                <input type="text" placeholder="Confirm password" class="primary cf-password">

                <div class="errors"></div>

                <div class="button-group">
                    <button class="back-to-login primary">Back to login</button>
                    <button class="sign-up primary">Sign up</button>
                </div>
            </form>

            <script>
                function loginSucess() {
                    window.location.href = './index.html'
                }

                $('form.login button.sign-up').click(function (e) {
                    e.preventDefault()
                    $('form.login').hide()
                    $('form.sign-up').show()
                })

                $('form.sign-up button.back-to-login').click(function (e) {
                    e.preventDefault()
                    $('form.login').show()
                    $('form.sign-up').hide()
                })

                $('form.login button.login').click(function (e) {
                    e.preventDefault()
                    let un = $('form.login input.username').val()
                    let pw = $('form.login input.password').val()
                    let $formError = $('form.login .errors').html('')

                    api.login(un, pw, {
                        onDone: () => {
                            window.location.href = './index.html'
                        },
                        onFailed: (error) => {
                            if (error == ERROR.USERNAME_DOESNOT_EXIST) {
                                $formError.html('<span>*username không tồn tại!</span>')
                            } else if (error == ERROR.WRONG_PASSWORD) {
                                $formError.html('<span>*Sai mật khẩu!</span>')
                            } else {
                                $formError.html('<span>*Có lỗi xảy ra!</span>')
                            }
                        }
                    })
                })

                $('form.sign-up button.sign-up').click(function (e) {
                    e.preventDefault()
                    let fullname = $('form.sign-up input.fullname').val()
                    let un = $('form.sign-up input.username').val()
                    let pw = $('form.sign-up input.password').val()
                    let cfpw = $('form.sign-up input.cf-password').val()

                    let $formError = $('form.sign .errors').html('')
                    if (pw != cfpw) {
                        $formError.html('<span>*Mật khẩu và mật khẩu xác nhận khác nhau!</span>')
                        return
                    }

                    api.signUp(fullname, un, pw, {
                        onDone: () => $('form.sign-up button.back-to-login').click(),
                        onFailed: (error) => {
                            if (error == ERROR.EXISTED_USERNAME) {
                                $formError.html('<span>*usernam đã tồn tại!</span>')
                            } else {
                                $formError.html('<span>*Có lỗi xảy ra!</span>')
                            }
                        }
                    })
                })
            </script>
        </div>
    </div>
</body>
</html>