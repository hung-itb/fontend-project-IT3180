<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý thu chi</title>

    <!-- <link rel="stylesheet" href="./resources/bootstrap.min.css">
    <script src="./resources/bootstrap.bundle.min.js"></script> -->

    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./common.css">

    <script src="./resources/jquery.min.js"></script>
    <script src="./lib.js"></script>
    <script src="./api.js"></script>

    <script>
        let user = null
        let currentRoom = null
    </script>
</head>

<body>
    <!-- Redirect to login.html if user haven't logined -->
    <script>
        let userId = localStorage.getItem('userId')
        api.getUserInfo(userId, {
            onDone: (resultUser) => {
                user = resultUser
            },
            onFailed: () => {
                window.location.href = './login.html'
            }
        })
    </script>

    <nav id="navbar">
        <div id="nav-left-side">
            <!-- list rooms -->
            <div class="op-with-room" style="display: none;">
                <img src="./resources/add.png" alt="" class="add-room">
                <div class="join-room">
                    <input type="text">
                    <div class="img-wrap">
                        <img src="./resources/right-arrow.png" alt="">
                    </div>
                </div>
            </div>

            <!-- room details -->
            <div class="room-details">
                <div class="room-name">
                    Phòng nào đó
                </div>

                <div class="switch-room">
                    Đổi phòng
                </div>
            </div>
        </div>
        <div id="nav-right-side">
            <input type="text" placeholder="Message" class="message">
            <img src="./resources/default-avatar.jpg" alt="" id="user-icon">
            <div class="log-out">Log out</div>

            <!-- Redirect to login.html when user logout -->
            <script>
                let jImg = $('#nav-right-side img')
                jImg.width(jImg.height())
                jImg.attr('src', user.avatarUrl || './resources/user-images/default-avatar.jpg')
                $('#nav-right-side .log-out').click(() => {
                    api.logout({
                        onDone: () => { window.location.href = './login.html' },
                        onFailed: (error) => alert(`ERROR: ${error || 'Có lỗi xảy ra'}!`)
                    })
                })
            </script>
        </div>
    </nav>

    <div id="main-container">
        <!-- Adjust the container height the first time acess page and when widow resize -->
        <script>
            function resizeMainContainer() {
                $('#main-container').outerHeight($(window).height() - $('#navbar').outerHeight())
            }
            resizeMainContainer()
            $(window).resize(resizeMainContainer)
        </script>

        <div id="left-side-bar">
            <div class="item active" tab-id="input-transaction">
                <span>Nhập liệu chi tiêu</span>
            </div>
            <div class="item" tab-id="fixed-costs">
                <span>Chi phí cố định</span>
            </div>
            <div class="item" tab-id="room-members">
                <span>Thành viên</span>
            </div>
            <div class="item" tab-id="request-payments">
                <span>Yêu cầu đóng phí</span>
            </div>

            <!-- Switch tab handler -->
            <script>
                $('#left-side-bar .item').click(function () {
                    let item = $(this)
                    if (!item.hasClass('active')) {
                        item.siblings('.item').removeClass('active')
                        item.addClass('active')
                        $('#main-container > .content').each(function () {
                            $(this).toggle($(this).attr('id') == item.attr('tab-id'))
                        })
                    }
                })
            </script>
        </div>

        <!-- Nhập xuất giao dịch -->
        <div class="content" id="input-transaction">
            <div class="left">
                <form action="">
                    <input type="text" placeholder="@productname" class="primary" name="name">
                    <input type="text" placeholder="@price" class="primary" name="price">
                    <input type="text" placeholder="@dd/mm/yy" class="primary" name="date">

                    <span class="errors"></span>
                    <button class="primary">Submit</button>
                </form>

                <div id="money-spent">
                    <div class="line" id="my-spent">
                        <span class="title">You spent:</span>
                        <span class="value value-green">230k</span>
                    </div>
                    <div class="line room-average">
                        <span class="title">Room average:</span>
                        <span class="value">100k</span>
                    </div>
                </div>
            </div>

            <div class="right">
                <div id="list-transactions">
                    <div class="time-control">
                        <img src="./resources/prev.png" alt="" class="prev-month time-control-button">
                        <div class="time">November</div>
                        <img src="./resources/next.png" alt="" class="next-month time-control-button">
                    </div>
                    <select class="user-selection">
                        <option value="">Mọi người</option>
                        <option value="">Hùng đẹp trai</option>
                    </select>

                    <div id="transactions">

                    </div>
                </div>
            </div>
        </div>

        <!-- Chi phí cố định -->
        <div class="content" id="fixed-costs" style="display: none;">
            <div class="left">
                <!-- user -->
                <div id="list-fixed-costs" style="display: none;">
                    <div class="group-top">
                        <div class="header">
                            <div class="header-col">Tên chi phí</div>
                            <div class="header-col">Số lượng</div>
                        </div>
    
                        <div class="note">
                            <div class="title">Trạng thái:</div>
                            <div class="item">
                                <div class="color" style="background-color: #1BDD2E;"></div>
                                <div class="name">Đã đóng</div>
                            </div>
                            <div class="item">
                                <div class="color" style="background-color: #D80032;"></div>
                                <div class="name">Chưa đóng</div>
                            </div>
                        </div>
                    </div>

                    <div class="fixed-costs">
                        <div class="item">
                            <div class="title">Chi phí 1</div>
                            <div class="value">10k</div>
                        </div>

                        <div class="item">
                            <div class="title">Chi phí 2</div>
                            <div class="value done">15k</div>
                        </div>

                        <div class="item">
                            <div class="title">Chi phí 3</div>
                            <div class="value done">25k</div>
                        </div>
                    </div>

                    <div class="total">
                        <div class="title">Tổng</div>
                        <div class="value">40/50</div>
                    </div>
                </div>

                <!-- admin -->
                <div id="list-fixed-costs-admin">
                    <div class="header">
                        Danh sách ...
                    </div>

                    <div class="users">
                        <div class="line">
                            <div class="col">
                                Nguyễn Văn Hùng
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Phạm Văn Phong
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Trần Văn Lực
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Nguyễn Mạnh Hiệp
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Nguyễn Văn Mạnh
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Người yêu Nguyễn Văn Hùng
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Em của Nguyễn Văn Hùng
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Đệ tử Nguyễn Văn Hùng
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>

                        <div class="line">
                            <div class="col">
                                Người yêu 2 Nguyễn Văn Hùng
                            </div>
                            <div class="col">
                                Tiền điện
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền phòng
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền nước
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền wifi
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền hát karaoke
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền mừng cưới
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền học lại
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền đám cưới người yêu cũ
                                <input type="checkbox" name="" id="">
                            </div>
                            <div class="col">
                                Tiền sửa nhà
                                <input type="checkbox" name="" id="">
                            </div>
                        </div>
                    </div>

                    <div class="total">
                        <div class="line">
                            <div class="col">Đã đóng</div>
                            <div class="col">1/2</div>
                            <div class="col">1/3</div>
                            <div class="col">1/4</div>
                            <div class="col">1/5</div>
                            <div class="col">1/6</div>
                            <div class="col">1/7</div>
                            <div class="col">1/8</div>
                            <div class="col">1/9</div>
                            <div class="col">100/1000</div>
                        </div>
                    </div>

                    <script>
                        $('#list-fixed-costs-admin .users').scroll(function () {
                            $('#list-fixed-costs-admin .total').scrollLeft($(this).scrollLeft())
                        })
                    </script>
                </div>
            </div>

            <div class="right">
                <div id="fixed-costs-general-info">
                    <div class="header">Tổng</div>
                    <div class="item">
                        <div class="title">Tiền phòng:</div>
                        <div class="value">1700k</div>
                    </div>
                    <div class="item">
                        <div class="title">Tiền điện:</div>
                        <div class="value">560k</div>
                    </div>
                    <div class="item">
                        <div class="title">Tiền nước:</div>
                        <div class="value">110k</div>
                    </div>
                    <div class="item total">
                        <div class="title">Tổng của tổng</div>
                        <div class="value">2370k</div>
                    </div>
                </div>

                <div id="admin-bank-info">
                    <div class="header">Thông tin ngân hàng</div>
                    <div class="info">STK: 0384742590</div>
                    <div class="info">Ngân hàng: BIDV</div>
                    <div class="info">Pham Van Phong</div>
                    <img src="./resources/general.jpg" alt="" class="qr-code">
                </div>
            </div>
        </div>

        <!-- Danh sách thành viên phòng -->
        <div class="content" id="room-members" style="display: none;">
            <div class="list-members">
                <div class="header">
                    Danh sách thành viên
                </div>

                <div class="item">
                    <img src="./resources/user.png" alt="">
                    <div class="name">Name</div>
                    <div class="phone">Phone</div>
                    <div class="bank">
                        Bank
                        <div class="more-info">
                            Chi tiết
                        </div>
                    </div>
                </div>
    
                <div class="item">
                    <img src="./resources/user.png" alt="">
                    <div class="name">Name</div>
                    <div class="phone">Phone</div>
                    <div class="bank">
                        Bank
                        <div class="more-info">
                            Chi tiết
                        </div>
                    </div>
                </div>
    
                <div class="item">
                    <img src="./resources/user.png" alt="">
                    <div class="name">Name</div>
                    <div class="phone">Phone</div>
                    <div class="bank">
                        Bank
                        <div class="more-info">
                            Chi tiết
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Yêu cầu đóng phí, admin -->
        <div class="content" id="request-payments" style="display: none;">
            <div id="list-request-payments">
                <div class="list">
                    <div class="headers">
                        <div class="header">
                            <div class="title">Tên chi phí</div>
                            <input type="text">
                        </div>
                        <div class="header">
                            <div class="title">Số tiền</div>
                            <input type="text">
                        </div>
                        <div class="header">
                            <div class="title">Thời hạn</div>
                            <input type="text">
                        </div>
                    </div>

                    <div class="items">
                        <div class="row">
                            <div class="field"><div class="wrap">1. Tiền điện</div></div>
                            <div class="field"><div class="wrap">1300k</div></div>
                            <div class="field"><div class="wrap">7/11/2023</div></div>
                        </div>
                        <div class="row">
                            <div class="field"><div class="wrap">2. Tiền wifi</div></div>
                            <div class="field"><div class="wrap">260k</div></div>
                            <div class="field"><div class="wrap">29/11/2023</div></div>
                        </div>
                        <div class="row">
                            <div class="field"><div class="wrap">3. Tiền phòng</div></div>
                            <div class="field"><div class="wrap">15000k</div></div>
                            <div class="field"><div class="wrap">15/11/2023</div></div>
                        </div>
                        <div class="row">
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                        </div>
                        <div class="row">
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                        </div>
                        <div class="row">
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                            <div class="field"><div class="wrap"></div></div>
                        </div>
                    </div>
                </div>

                <div class="operations">
                    <div class="op">
                        <img src="./resources/add.png" alt="">
                    </div>
                </div>
            </div>
        </div>

        <!-- Danh sách phòng -->
        <div id="list-rooms" style="display: none;">
            <div class="main-rooms">
                <div class="room">
                    <div class="title">Phòng 1</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 2</div>
                </div>
            </div>

            <div class="normal-rooms">
                <div class="room">
                    <div class="title">Phòng 3</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 4</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 5</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 6</div>
                </div>
                <div class="room">
                    <div class="title">Phòng 7</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 8</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 9</div>
                </div>

                <div class="room">
                    <div class="title">Phòng 10</div>
                </div>
            </div>
        </div>
    </div>

    <div class="pop-up-wrap" style="display: none;">
        <div class="pop-up">
            
            <div class="button-group">
                <button class="close primary">Đóng</button>
            </div>
        </div>
    </div>

    <script>

        function showRoomDetails() {
            $('#list-rooms').hide()
            $('#nav-left-side .op-with-room').hide()
            $('#left-side-bar').show()
            $('#input-transaction').show()
            $('#nav-left-side .room-details').show()
            $('#nav-right-side input.message').show()

            $('#navbar .room-details .room-name').html(currentRoom.roomName)
            $('#left-side-bar .item[tab-id="input-transaction"]').click()

            let isAdmin = (user.id == currentRoom.adminUserId)
            $('#left-side-bar .item[tab-id="request-payments"]').toggle(isAdmin)
        }
        
        function loadListRoomViews(rooms) {
            $('#list-rooms .main-rooms').html('')
            for (let i = 0; i < rooms.length && i < 2; i++) {
                let roomHtml = (`
                    <div class="room">
                        <div class="title">${rooms[i].roomName}</div>
                    </div>
                `)
                let jRoom = $(roomHtml)
                $('#list-rooms .main-rooms').append(jRoom)
                jRoom.click(() => {
                    currentRoom = rooms[i]
                    showRoomDetails()
                })
            }

            $('#list-rooms .normal-rooms').html('')
            for (let i = 2; i < rooms.length; i++) {
                let roomHtml = (`
                    <div class="room">
                        <div class="title">${rooms[i].roomName}</div>
                    </div>
                `)
                let jRoom = $(roomHtml)
                $('#list-rooms .normal-rooms').append(jRoom)
                jRoom.click(() => {
                    currentRoom = rooms[i]
                    showRoomDetails()
                })
            }
        }

        function showListRooms() {
            $('#main-container > *').hide()
            $('#nav-left-side .room-details').hide()
            $('#nav-right-side input.message').hide()
            $('#list-rooms').show()
            $('#nav-left-side .op-with-room').show()

            api.getRoomsOfUser({
                onDone: loadListRoomViews,
                onFailed: () => {
                    alert('Có lỗi xảy ra!')
                }
            })
        }
        $('#nav-left-side .room-details .switch-room').click(showListRooms)
        showListRooms()
    </script>

    <script src="./main.js"></script>
</body>

</html>